# 🛑 통계적 서킷 브레이커 (Circuit Breaker) 제안

"감으로 끄는 게 아니라, 데이터가 위험하다고 할 때 끄는" 로직입니다.

## 1. 핵심 아이디어: "표준편차 4배(4σ) 사건" 감지
비트코인의 분당 변동성은 평소에 일정 범위(정규분포) 내에 있습니다. 갑자기 3,000포인트가 오르는 건 **통계적으로 0.1% 미만의 희귀 사건(Black Swan)** 띱니다. 이때는 기계적 매매가 통하지 않으므로 멈춰야 합니다.

## 2. 제안 알고리즘: ATR Multiplier

### 📊 지표 정의
- **Baseline (평상시 변동성)**: 최근 60분의 `1분봉 Range(고가 - 저가)` 평균. (이를 `ATR_60m`이라 부름).
- **Current (현재 변동성)**: 방금 마감된 `1분봉 Range` (또는 현재 진행 중인 틱 변동폭).

### ⚙️ 발동 조건 (Trigger)
$$ \text{Current Range} > (\text{ATR\_60m} \times 4.0) $$

*   평소에 1분에 `$50` 움직이던 놈이, 갑자기 1분에 `$200` 움직이면 발동.
*   **Multiplier 4.0**은 통계적으로 약 `4-Sigma` 수준으로, 웬만한 추세장에서도 안 걸리고 **"찐 폭등/폭락"** 때만 걸립니다.

### 🛡️ 대응 액션 (Action)
1.  **매매 정지 (Sleep)**: 즉시 모든 주문 취소(`Cancel All`) 후 15분간 대기.
2.  **쿨다운 (Cooldown)**: 15분 후 다시 시장 변동성 체크. 여전히 높으면 15분 추가 연장.

## 3. Config 설정 예시
```yaml
risk:
  circuit_breaker:
    enabled: true
    window_minutes: 60      # 기준 시간 (60분 평균)
    sigma_multiplier: 4.0   # 민감도 (낮을수록 자주 꺼짐, 3.0~5.0 추천)
    cooldown_minutes: 15    # 휴식 시간
```

## 4. 기대 효과
- **어제 상황 대입**: 평소 1분 변동폭이 $100 내외였을 텐데, 3,000포인트 급등 시 1분에 $500~$1000씩 움직였을 것임.
- **결과**: 급등 초입(약 $400 움직였을 때)에 서킷 브레이커 발동 -> **나머지 $2600 상승분 동안 봇은 꿀잠 잠** -> 재고 물림 방지 성공. ✅

---

이 로직으로 구현을 진행할까요?
