# 🌪️ 급등락(Flash Pump/Crash) 대응 전략

어제와 같이 **단기간에 3,000포인트 급등**하는 상황에서, 역추세(Short) 물량이 쌓이고 재고 처리가 안 되는 현상을 방지하기 위한 개선안입니다.

## 1. 🛑 서킷 브레이커 (Circuit Breaker) - **추천**
가장 단순하고 강력한 방법입니다. 시장이 미쳐 날뛸 때는 **매매를 멈추는 것**이 상책입니다.

- **로직**: 1분봉 변동성이 `X%` (예: 1%) 이상 발생하면, 봇을 **10분간 Sleep** 시킵니다.
- **효과**: 불필요한 고점 매수(Short 물타기)를 방지하고, 시장이 진정된 후 다시 진입합니다.
- **구현 난이도**: 하 (Config에 `max_volatility_pct` 추가).

## 2. 🌊 추세 추종 스위칭 (Trend Following Flip)
현재 봇은 `Neutral` 모드에서 역추세(박스권) 매매를 주로 합니다. 이를 급등 시 **추세 추종**으로 바꿔야 합니다.

- **로직**: 가격이 볼린저 밴드 상단을 강하게 돌파하고 RSI가 80을 넘어가면, `Sell`을 금지하고 `Buy`만 허용(또는 관망)합니다.
- **개선점**: 현재 `MarketMaker`의 `regime` 탐지 로직을 더 민감하게 튜닝해야 합니다. (RSI 70 -> 80 상향 등).

## 3. ✂️ 비상 손절 (Emergency Cut)
존버(Entry Anchor)는 결국 돌아온다는 믿음이 있을 때 유효하지만, **추세가 완전히 터지면** 빨리 자르는 게 낫습니다.

- **로직**:
    - 재고(Inventory)가 90% 이상 찼는데,
    - 미실현 손실(Unrealized PnL)이 `-3%`를 넘어가면,
    - **강제 시장가 청산(Market Stop Loss)** 실행.
- **효과**: 한 번 크게 맞더라도, 시드머니 전체가 잠기는(Lock) 최악의 상황은 면합니다.

## 4. 📉 재고 한도 축소 (Dynamic Inventory)
변동성이 커지면 운용 재고량을 줄입니다.

- **로직**: ATR(평균 변동폭)이 높아지면 `max_position_usd`를 자동으로 절반으로 줄입니다.
- **효과**: 리스크 노출을 줄입니다.

---

### ✅ 적용 권고 순서
1. **서킷 브레이커 도입**: 급등 시 일단 멈추게 합니다. (가장 시급).
2. **비상 손절 로직**: 최후의 안전장치를 마련합니다.
3. **추세 로직 강화**: 섣불리 숏을 치지 않도록 필터를 강화합니다.
